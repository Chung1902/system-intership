# Tìm hiểu về virsh client và các option thông dụng của virsh command
## 1. Virsh là gì?
`virsh` là một công cụ dòng lệnh dùng để quản lý máy ảo (Virtual Machines - VMs) thông qua libvirt — một thư viện và API cho ảo hóa. virsh cho phép bạn điều khiển máy ảo mà không cần giao diện đồ họa.
## 2. Ứng dụng chính của virsh
- Quản lý vòng đời của máy ảo (khởi động, tắt, tạm dừng, khôi phục…).
- Tạo, chỉnh sửa, hoặc xóa máy ảo.
- Quản lý snapshot, lưu trữ, mạng ảo.
- Kết nối với hypervisor từ xa (remote hypervisor).
## 3. Cú pháp chung
```
virsh [GLOBAL OPTIONS] <command> [COMMAND OPTIONS] [args]
```
## 4. Lệnh cơ bản theo nhóm
### 4.1  Liệt kê & thông tin VM
```
virsh list               # VM đang chạy
virsh list --all         # Tất cả VM
virsh list --name        # Chỉ tên
virsh dominfo <vm>       # Thông tin chi tiết
virsh domuuid <vm>       # Lấy UUID
virsh domstats --state   # Thống kê nhanh nhiều VM
```
### 4.2 Vòng đời VM
```
virsh start <vm>                 # Bật
virsh shutdown <vm>              # Tắt “mềm”
virsh destroy <vm>               # Tắt “rút điện” (cẩn thận!)
virsh reboot <vm>                # Khởi động lại
virsh suspend <vm>               # Tạm dừng
virsh resume <vm>                # Tiếp tục
virsh autostart <vm>             # Bật autostart
virsh autostart --disable <vm>   # Tắt autostart
```
### 4.3 Tạo/định nghĩa cấu hình
```
virsh define <file.xml>   # Tạo VM (persist) từ XML
virsh undefine <vm>       # Gỡ định nghĩa (không xóa disk)
virsh edit <vm>           # Sửa XML bằng editor
virsh create <file.xml>   # Chạy “tạm thời” từ XML (không persist)
```
### 4.4 Snapshot
```
virsh snapshot-list <vm>
virsh snapshot-create-as <vm> <snap_name>
virsh snapshot-revert <vm> --snapshotname <snap_name>
virsh snapshot-delete <vm> --snapshotname <snap_name>
```
### 4.5 Thiết bị, tài nguyên gắn kèm
```
virsh attach-disk <vm> /path/img vdb --live --config
virsh detach-disk <vm> vdb --live --config
virsh attach-interface <vm> network default --model virtio --live --config
virsh detach-interface <vm> network --mac <MAC> --live --config
virsh attach-device <vm> dev.xml --live --config
virsh detach-device <vm> dev.xml --live --config
```
### 4.6 Tài nguyên tính toán
```
virsh setvcpus <vm> 4 --live --config     # chỉnh vCPU
virsh setmem <vm> 8G --live --config      # chỉnh RAM
virsh vcpucount <vm> --live --config --maximum
virsh dommemstat <vm>                     # thống kê RAM
```
### 4.7 Mạng ảo (libvirt network)
```
virsh net-list --all
virsh net-start <net>
virsh net-destroy <net>
virsh net-autostart <net>
virsh net-edit <net>
```
### 4.8 Lưu trữ (pool/volume)
```
virsh pool-list --all
virsh pool-start <pool>
virsh pool-autostart <pool>
virsh vol-list <pool>
virsh vol-create-as <pool> disk1 20G --format qcow2
virsh vol-path <pool> disk1
virsh vol-delete <pool> disk1
```
### 4.9  Console/hiển thị
```
virsh console <vm>        # vào serial console (Ctrl+] để thoát)
virsh vncdisplay <vm>     # xem VNC display
virsh domifaddr <vm>      # IP trong guest (cần qemu-guest-agent)
```
### 4.10 Hệ thống/host
```
virsh uri                 # URI đang kết nối
virsh hostname            # hostname của hypervisor
virsh capabilities        # khả năng host/hypervisor
```
