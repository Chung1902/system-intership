# Tìm hiểu về công nghệ Linux Bridge
## 1. Linux Bridge là gì?
Linux-bridge là một mô hình ảo hóa mạng được hỗ trợ bởi KVM. Linux bridge là một công nghệ cung cấp switch ảo để giải quyết vấn đề ảo hóa Network bên trong các máy vật lý.

![](../imgs/87.png)

Một con switch được tạo ra nằm bên trong của máy vật lý. Các VM kết nối đến đây để có thể liên lạc được với nhau. Nếu muốn liên lạc ra bên ngoài ta có thể kết nối con switch này với card mạng trên máy vật lý của ta.
## 2. Cấu trúc của Linux Bridge
![](../imgs/88.png)

Trong đó:

- Bridge ở đây là switch ảo
- Tap hay tap interface là giao diện mạng để các VM kết nối với switch do Linux bridge tạo ra(nó hoạt động ở lớp 2 của mô hình OSI)
- fd: Forward data có nhiệm vụ chuyển dữ kiệu từ VM tới switch.
## 3. Chức năng của một switch ảo do Linux bridge tạo ra
- **STP:** là tính năng chống loop gói tin trong switch
- **Vlan:** là tính năng rất quan trọng trong một switch
- **FDB:** là tính năng chuyển gói tin theo database được xây dựng giúp tăng tốc độ của switch
## 4. Tạo và quản lí Linux bridge
- Để tạo một linux bridge(switch ảo) ta dùng lệnh `brctl addbr tên_switch`.
```
brctl addbr testbr
```
- Tiếp theo là bước add card mạng cho switch dùng lệnh `brctl addif tên_switch tên_card`.

   - Tên swich ở đây là switch ta vừa mới tạo ở câu lệnh bên trên.
   - Tên card ở đây là card mạng trên máy vật lý của ta (trừ card wireless).

```
brctl addif testbr ens33
```
- Để kiểm tra những swtich ảo trên máy và những card đã được add vào switch ảo đó ta dùng lệnh `brctl show`.
- Tiếp sau đó ta tiến hành xin cấp IP cho NIC. Ta dùng các câu lệnh sau để xóa IP của card ens9 `ifconfig tên_card 0`.
- Sau đó xin cấp IP cho bridge bằng lệnh `dhclient tên_bridge`.
- Lưu ý hai câu lệnh trên chỉ có hiệu lực đến khi ta reboot lại máy vật lý. Để VM có thể nhận được địa chỉ IP ngay cả khi server vật lý bị reboot ta thực hiện ghi các dòng như sau vào file `/ect/network/interfaces`.
- Sau đó tiến hành chạy lênh `ifdown -a && ifup -a` để khởi động lại internet.

Tài liệu tham khảo: 

[1] (https://blog.cloud365.vn/linux/huong-dan-tao-su-dung-mo-hinh-mang-linux-bridge-KVM/)
